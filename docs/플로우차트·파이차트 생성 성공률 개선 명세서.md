# í”Œë¡œìš°ì°¨íŠ¸Â·íŒŒì´ì°¨íŠ¸ ìƒì„± ì„±ê³µë¥  ê°œì„  ëª…ì„¸ì„œ

> **í”„ë¡œì íŠ¸**: SnapChart  
> **ë²„ì „**: v1.0  
> **ì‘ì„±ì¼**: 2025-10-17  
> **ë‹´ë‹¹**: ì•„í…Œë‚˜ (AI í”„ë¡¬í”„íŠ¸ ì—”ì§€ë‹ˆì–´) + ë±ìŠ¤ (ë°±ì—”ë“œ êµ¬í˜„)  
> **ëª©í‘œ**: í”Œë¡œìš°ì°¨íŠ¸ & íŒŒì´ì°¨íŠ¸ ìƒì„± ì„±ê³µë¥  **75% â†’ 95%+** ë‹¬ì„±

---

## ğŸ“Š Executive Summary

### í˜„ì¬ ìƒí™©
```
í…ŒìŠ¤íŠ¸ ê²°ê³¼ (Node.js í™˜ê²½):
- ì „ì²´ ì„±ê³µë¥ : 75% (6/8)
- âŒ í”Œë¡œìš°ì°¨íŠ¸ ì‹¤íŒ¨ (40% ì‚¬ìš© ì˜ˆìƒ, Critical)
- âŒ íŒŒì´ ì°¨íŠ¸ ì‹¤íŒ¨ (10% ì‚¬ìš© ì˜ˆìƒ, High)
- âœ… ë‚˜ë¨¸ì§€ 6ê°œ íƒ€ì… ì„±ê³µ
```

### ê°œì„  ì „ëµ
```
1. ğŸ¯ í”„ë¡¬í”„íŠ¸ ì—”ì§€ë‹ˆì–´ë§ (í•µì‹¬)
   - Few-shot í•™ìŠµ
   - Gemini ìµœì í™” í…œí”Œë¦¿
   - ëª…ì‹œì  ì¶œë ¥ í¬ë§· ì§€ì •

2. âš¡ ëŸ°íƒ€ì„ ìµœì í™”
   - Node.js â†’ Bun (4ë°° ë¹ ë¥¸ ì‹¤í–‰)
   - ì‘ë‹µ ì‹œê°„ ë‹¨ì¶•

3. ğŸ”„ ì¬ì‹œë„ ë©”ì»¤ë‹ˆì¦˜
   - ì‹¤íŒ¨ ì‹œ ìë™ ì¬ì‹œë„ (ìµœëŒ€ 3íšŒ)
   - Fallback to Claude

4. âœ… ê²€ì¦ ì‹œìŠ¤í…œ
   - Mermaid ë¬¸ë²• ì‚¬ì „ ê²€ì¦
   - ì‹¤ì‹œê°„ ë Œë”ë§ í…ŒìŠ¤íŠ¸
```

### ì˜ˆìƒ ê²°ê³¼
```
ğŸ“ˆ ëª©í‘œ ì„±ê³µë¥ : 95%+ (8ê°œ ì¤‘ 7.6ê°œ)
âš¡ ì‘ë‹µ ì†ë„: í‰ê·  6.2ì´ˆ â†’ 4.5ì´ˆ (Bun ì ìš©)
ğŸ’° ë¹„ìš©: ë™ì¼ ($0.0020/ìš”ì²­)
ğŸ¯ ì‹ ë¢°ë„: ìƒìš© ì„œë¹„ìŠ¤ ìˆ˜ì¤€ ë‹¬ì„±
```

---

## ğŸ¯ Part 1: ì‹¤íŒ¨ ì›ì¸ ë¶„ì„

### 1.1 í”Œë¡œìš°ì°¨íŠ¸ ì‹¤íŒ¨ ì›ì¸

#### í˜„ì¬ í”„ë¡¬í”„íŠ¸ (ì‹¤íŒ¨)
```
"ë¡œê·¸ì¸ í”„ë¡œì„¸ìŠ¤ë¥¼ Mermaid í”Œë¡œìš°ì°¨íŠ¸ë¡œ ë§Œë“¤ì–´ì¤˜. 
ì‹œì‘â†’ì´ë©”ì¼ì…ë ¥â†’ë¹„ë°€ë²ˆí˜¸ì…ë ¥â†’ì¸ì¦â†’ì„±ê³µ/ì‹¤íŒ¨"
```

#### ì‹¤íŒ¨ íŒ¨í„´ ë¶„ì„
```typescript
// Geminiê°€ ìƒì„±í•œ ì˜ëª»ëœ ì½”ë“œ (ì¶”ì •)
graph TD
  Start[ì‹œì‘] --> Email
  Email[ì´ë©”ì¼ì…ë ¥] --> Password
  ...
  // ë¬¸ì œ 1: 'graph TD' ëŒ€ì‹  'flowchart TD' í•„ìš” (Mermaid v9.0+)
  // ë¬¸ì œ 2: ì¡°ê±´ ë¶„ê¸° ë¬¸ë²• ì˜¤ë¥˜
  // ë¬¸ì œ 3: í™”ì‚´í‘œ ë¼ë²¨ ì²˜ë¦¬ ë¯¸í¡
```

#### ê·¼ë³¸ ì›ì¸
1. **ëª¨í˜¸í•œ ì§€ì‹œì‚¬í•­**
   - "í”Œë¡œìš°ì°¨íŠ¸ë¡œ ë§Œë“¤ì–´ì¤˜" â†’ Geminiê°€ graph TD ì‚¬ìš©
   - Mermaid v9.0+ ì´í›„ flowchart TD ê¶Œì¥

2. **ì˜ˆì œ ë¶€ì¡±**
   - Few-shot ì˜ˆì œ ì—†ì´ Zero-shot ìš”ì²­
   - GeminiëŠ” ì˜ˆì œ ê¸°ë°˜ í•™ìŠµì— ê°•í•¨

3. **ì¶œë ¥ í¬ë§· ë¶ˆëª…í™•**
   - "ì½”ë“œë§Œ ì¶œë ¥"ì´ë¼ê³  í–ˆì§€ë§Œ ì„¤ëª… í¬í•¨ ê°€ëŠ¥ì„±
   - ë§ˆí¬ë‹¤ìš´ ì½”ë“œ ë¸”ë¡ ìƒì„± ê°€ëŠ¥ì„±

### 1.2 íŒŒì´ ì°¨íŠ¸ ì‹¤íŒ¨ ì›ì¸

#### í˜„ì¬ í”„ë¡¬í”„íŠ¸ (ì‹¤íŒ¨)
```
"ì›”ë³„ ë§¤ì¶œ ë¹„ì¤‘ì„ Mermaid pie ì°¨íŠ¸ë¡œ. 
1ì›”(25%), 2ì›”(30%), 3ì›”(45%)"
```

#### ì‹¤íŒ¨ íŒ¨í„´ ë¶„ì„
```typescript
// Geminiê°€ ìƒì„±í•œ ì˜ëª»ëœ ì½”ë“œ (ì¶”ì •)
pie
  title ì›”ë³„ ë§¤ì¶œ ë¹„ì¤‘
  "1ì›”" : 25
  "2ì›”" : 30
  "3ì›”" : 45
  // ë¬¸ì œ: í¼ì„¼íŠ¸ í•©ê³„ê°€ 100ì´ì§€ë§Œ MermaidëŠ” ë¹„ìœ¨ ìë™ ê³„ì‚°
  // ë˜ëŠ”: ë¬¸ë²• ì˜¤ë¥˜ (showData, ë”°ì˜´í‘œ ì²˜ë¦¬ ë“±)
```

#### ê·¼ë³¸ ì›ì¸
1. **ë°ì´í„° í¬ë§· í˜¼ë€**
   - "25%" vs 25 (ìˆ«ìë§Œ vs í¼ì„¼íŠ¸ í‘œê¸°)
   - Mermaid pieëŠ” ìˆ«ìë§Œ ë°›ìŒ

2. **ë¬¸ë²• ë¯¼ê°ì„±**
   - ë„ì–´ì“°ê¸°, ë”°ì˜´í‘œ, ì½œë¡  ìœ„ì¹˜ì— ë¯¼ê°
   - Geminiê°€ ë¯¸ì„¸í•œ ë¬¸ë²• ì˜¤ë¥˜ ë°œìƒ ê°€ëŠ¥

3. **ê²€ì¦ ë¡œì§ ë¶€ì¬**
   - ìƒì„±ëœ ì½”ë“œì˜ ë¬¸ë²• ê²€ì¦ ì—†ìŒ
   - í¼ì„¼íŠ¸ í•©ê³„ ê²€ì¦ ì—†ìŒ

---

## ğŸ”§ Part 2: ê°œì„  ì†”ë£¨ì…˜ ì„¤ê³„

### 2.1 í”Œë¡œìš°ì°¨íŠ¸ í”„ë¡¬í”„íŠ¸ ê°œì„ 

#### âœ… ê°œì„ ëœ í”„ë¡¬í”„íŠ¸ v2.0

```typescript
const FLOWCHART_SYSTEM_PROMPT = `ë‹¹ì‹ ì€ Mermaid í”Œë¡œìš°ì°¨íŠ¸ ì „ë¬¸ê°€ì…ë‹ˆë‹¤.

**ì¤‘ìš” ê·œì¹™**:
1. ë°˜ë“œì‹œ \`flowchart TD\` ë˜ëŠ” \`flowchart LR\`ë¡œ ì‹œì‘
2. ë…¸ë“œ IDëŠ” ì˜ë¬¸ (A, B, C ë“±)
3. í•œêµ­ì–´ ë¼ë²¨ì€ ëŒ€ê´„í˜¸ ì•ˆì—: A[ì‹œì‘]
4. ì¡°ê±´ ë¶„ê¸°ëŠ” ì¤‘ê´„í˜¸: B{ë¡œê·¸ì¸?}
5. í™”ì‚´í‘œ ë¼ë²¨ì€ íŒŒì´í”„: A -->|ì˜ˆ| B
6. ì½”ë“œë§Œ ì¶œë ¥ (ì„¤ëª…, ë§ˆí¬ë‹¤ìš´ ë¸”ë¡ ê¸ˆì§€)

**ì¶œë ¥ ì˜ˆì œ**:
flowchart TD
    A[ì‹œì‘] --> B{ë¡œê·¸ì¸ ì—¬ë¶€}
    B -->|ì˜ˆ| C[ëŒ€ì‹œë³´ë“œ]
    B -->|ì•„ë‹ˆì˜¤| D[ë¡œê·¸ì¸ í˜ì´ì§€]
    D --> E[ì™„ë£Œ]`;

const FLOWCHART_USER_PROMPT = (description: string) => `
ë‹¤ìŒ í”„ë¡œì„¸ìŠ¤ë¥¼ Mermaid flowchartë¡œ ìƒì„±í•˜ì„¸ìš”:

"${description}"

**í•„ìˆ˜ ìš”êµ¬ì‚¬í•­**:
- flowchart TDë¡œ ì‹œì‘
- ë…¸ë“œ ID: A, B, C, ...
- í•œêµ­ì–´ ë¼ë²¨ë§Œ ì‚¬ìš©
- ì¡°ê±´ ë¶„ê¸° ì‹œ ì¤‘ê´„í˜¸ ì‚¬ìš©
- ì½”ë“œë§Œ ì¶œë ¥

**ì˜ˆì œ ì¶œë ¥**:
flowchart TD
    A[ì‹œì‘] --> B{í™•ì¸}
    B -->|ì˜ˆ| C[ì§„í–‰]
    B -->|ì•„ë‹ˆì˜¤| D[ì¢…ë£Œ]
`;
```

#### Few-Shot í•™ìŠµ ì ìš©

```typescript
const FEW_SHOT_EXAMPLES = [
  {
    input: "íšŒì›ê°€ì… í”„ë¡œì„¸ìŠ¤",
    output: `flowchart TD
    A[ì‹œì‘] --> B[ì´ë©”ì¼ ì…ë ¥]
    B --> C[ë¹„ë°€ë²ˆí˜¸ ì…ë ¥]
    C --> D{ìœ íš¨ì„± ê²€ì‚¬}
    D -->|í†µê³¼| E[ê°€ì… ì™„ë£Œ]
    D -->|ì‹¤íŒ¨| B`
  },
  {
    input: "ê²°ì œ í”„ë¡œì„¸ìŠ¤",
    output: `flowchart TD
    A[ì¥ë°”êµ¬ë‹ˆ] --> B{ì¬ê³  í™•ì¸}
    B -->|ìˆìŒ| C[ê²°ì œ]
    B -->|ì—†ìŒ| D[í’ˆì ˆ ì•Œë¦¼]
    C --> E{ê²°ì œ ì„±ê³µ?}
    E -->|ì˜ˆ| F[ì£¼ë¬¸ ì™„ë£Œ]
    E -->|ì•„ë‹ˆì˜¤| C`
  },
  {
    input: "ë¡œê·¸ì¸ í”„ë¡œì„¸ìŠ¤",
    output: `flowchart TD
    A[ì‹œì‘] --> B[ID ì…ë ¥]
    B --> C[PW ì…ë ¥]
    C --> D{ì¸ì¦}
    D -->|ì„±ê³µ| E[ë©”ì¸]
    D -->|ì‹¤íŒ¨| F[ì¬ì‹œë„]
    F --> B`
  }
];

// Gemini API í˜¸ì¶œ ì‹œ Few-Shot ì ìš©
const promptWithExamples = `
${FLOWCHART_SYSTEM_PROMPT}

**í•™ìŠµ ì˜ˆì œ 3ê°œ**:

ì˜ˆì œ 1:
ì…ë ¥: "${FEW_SHOT_EXAMPLES[0].input}"
ì¶œë ¥:
${FEW_SHOT_EXAMPLES[0].output}

ì˜ˆì œ 2:
ì…ë ¥: "${FEW_SHOT_EXAMPLES[1].input}"
ì¶œë ¥:
${FEW_SHOT_EXAMPLES[1].output}

ì˜ˆì œ 3:
ì…ë ¥: "${FEW_SHOT_EXAMPLES[2].input}"
ì¶œë ¥:
${FEW_SHOT_EXAMPLES[2].output}

**ì´ì œ ë‹¹ì‹ ì˜ ì°¨ë¡€**:
ì…ë ¥: "${userInput}"
ì¶œë ¥:
`;
```

### 2.2 íŒŒì´ ì°¨íŠ¸ í”„ë¡¬í”„íŠ¸ ê°œì„ 

#### âœ… ê°œì„ ëœ í”„ë¡¬í”„íŠ¸ v2.0

```typescript
const PIE_CHART_SYSTEM_PROMPT = `ë‹¹ì‹ ì€ Mermaid íŒŒì´ ì°¨íŠ¸ ì „ë¬¸ê°€ì…ë‹ˆë‹¤.

**ì¤‘ìš” ê·œì¹™**:
1. ë°˜ë“œì‹œ \`pie\`ë¡œ ì‹œì‘
2. title ë¼ì¸ ì¶”ê°€ (ì„ íƒ)
3. ë°ì´í„° í¬ë§·: "ë¼ë²¨" : ìˆ«ì (í¼ì„¼íŠ¸ ì•„ë‹˜!)
4. ìˆ«ì í•©ê³„ ë¬´ê´€ (Mermaidê°€ ìë™ ë¹„ìœ¨ ê³„ì‚°)
5. í•œêµ­ì–´ ë¼ë²¨ ì‚¬ìš©
6. ì½”ë“œë§Œ ì¶œë ¥ (ì„¤ëª…, ë§ˆí¬ë‹¤ìš´ ë¸”ë¡ ê¸ˆì§€)

**ì¶œë ¥ ì˜ˆì œ**:
pie title ë§¤ì¶œ ë¹„ì¤‘
    "1ì›”" : 25
    "2ì›”" : 30
    "3ì›”" : 45`;

const PIE_CHART_USER_PROMPT = (description: string, data: Record<string, number>) => `
ë‹¤ìŒ ë°ì´í„°ë¥¼ Mermaid pie ì°¨íŠ¸ë¡œ ìƒì„±í•˜ì„¸ìš”:

ì œëª©: "${description}"
ë°ì´í„°: ${JSON.stringify(data, null, 2)}

**í•„ìˆ˜ ìš”êµ¬ì‚¬í•­**:
- pieë¡œ ì‹œì‘
- title ë¼ì¸ ì¶”ê°€
- "ë¼ë²¨" : ìˆ«ì í˜•ì‹
- í¼ì„¼íŠ¸ ê¸°í˜¸(%) ì‚¬ìš© ê¸ˆì§€
- ì½”ë“œë§Œ ì¶œë ¥

**ì˜ˆì œ ì¶œë ¥**:
pie title ${description}
    ${Object.entries(data).map(([key, val]) => `"${key}" : ${val}`).join('\n    ')}
`;
```

#### ë°ì´í„° ì „ì²˜ë¦¬ & ê²€ì¦

```typescript
interface PieChartData {
  title: string;
  data: Record<string, number>;
}

function validateAndPreprocessPieData(
  input: string
): PieChartData {
  // 1. í¼ì„¼íŠ¸ ì œê±° ë° ìˆ«ì ì¶”ì¶œ
  const percentPattern = /(\d+)%/g;
  const numbers: number[] = [];
  let match;
  
  while ((match = percentPattern.exec(input)) !== null) {
    numbers.push(parseInt(match[1]));
  }
  
  // 2. ë¼ë²¨ ì¶”ì¶œ
  const labels = input.match(/[ê°€-í£a-zA-Z0-9]+(?=\()/g) || [];
  
  // 3. ë°ì´í„° ì •ê·œí™”
  const data: Record<string, number> = {};
  labels.forEach((label, i) => {
    data[label] = numbers[i] || 0;
  });
  
  // 4. í•©ê³„ ê²€ì¦ (ê²½ê³ ë§Œ)
  const sum = Object.values(data).reduce((a, b) => a + b, 0);
  if (Math.abs(sum - 100) > 1) {
    console.warn(`âš ï¸ í¼ì„¼íŠ¸ í•©ê³„ ${sum}% (100%ê°€ ì•„ë‹˜)`);
  }
  
  return {
    title: extractTitle(input),
    data
  };
}

// ì‚¬ìš© ì˜ˆ
const rawInput = "ì›”ë³„ ë§¤ì¶œ ë¹„ì¤‘ì„ Mermaid pie ì°¨íŠ¸ë¡œ. 1ì›”(25%), 2ì›”(30%), 3ì›”(45%)";
const processed = validateAndPreprocessPieData(rawInput);
// { title: "ì›”ë³„ ë§¤ì¶œ ë¹„ì¤‘", data: { "1ì›”": 25, "2ì›”": 30, "3ì›”": 45 } }
```

---

## ğŸ—ï¸ Part 3: êµ¬í˜„ ì•„í‚¤í…ì²˜

### 3.1 ì‹œìŠ¤í…œ êµ¬ì¡°

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         ì‚¬ìš©ì ì…ë ¥ (ìì—°ì–´)                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Step 1: ì…ë ¥ ë¶„ì„ & ì „ì²˜ë¦¬                  â”‚
â”‚  â”œâ”€ ë‹¤ì´ì–´ê·¸ë¨ íƒ€ì… ê°ì§€                     â”‚
â”‚  â”œâ”€ ë°ì´í„° ì¶”ì¶œ (íŒŒì´ì°¨íŠ¸ì˜ ê²½ìš°)             â”‚
â”‚  â””â”€ í”„ë¡¬í”„íŠ¸ í…œí”Œë¦¿ ì„ íƒ                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Step 2: í”„ë¡¬í”„íŠ¸ ìƒì„±                       â”‚
â”‚  â”œâ”€ System Prompt (Few-Shot í¬í•¨)           â”‚
â”‚  â”œâ”€ User Prompt (ëª…ì‹œì  ì§€ì‹œì‚¬í•­)            â”‚
â”‚  â””â”€ ì˜ˆì œ ì¶”ê°€ (í•„ìš” ì‹œ)                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Step 3: API í˜¸ì¶œ (with Retry)               â”‚
â”‚  â”œâ”€ Gemini API (Primary)                    â”‚
â”‚  â”œâ”€ ì¬ì‹œë„ (ìµœëŒ€ 3íšŒ)                        â”‚
â”‚  â””â”€ Claude API (Fallback)                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Step 4: ì‘ë‹µ í›„ì²˜ë¦¬                         â”‚
â”‚  â”œâ”€ ë§ˆí¬ë‹¤ìš´ ì½”ë“œ ë¸”ë¡ ì œê±°                  â”‚
â”‚  â”œâ”€ ì•ë’¤ ê³µë°± ì œê±°                           â”‚
â”‚  â””â”€ ì„¤ëª… í…ìŠ¤íŠ¸ ì œê±°                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Step 5: ë¬¸ë²• ê²€ì¦                           â”‚
â”‚  â”œâ”€ Mermaid íŒŒì„œë¡œ ê²€ì¦                      â”‚
â”‚  â”œâ”€ ì‹¤íŒ¨ ì‹œ ì¬ìƒì„± ìš”ì²­                      â”‚
â”‚  â””â”€ ìµœëŒ€ 3íšŒ ì¬ì‹œë„                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Step 6: ë Œë”ë§ í…ŒìŠ¤íŠ¸                       â”‚
â”‚  â”œâ”€ Mermaid.jsë¡œ SVG ìƒì„±                    â”‚
â”‚  â”œâ”€ ì„±ê³µ ì‹œ ìºì‹œ ì €ì¥                        â”‚
â”‚  â””â”€ ì‹¤íŒ¨ ì‹œ ì—ëŸ¬ ë¦¬í¬íŠ¸                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         ìµœì¢… Mermaid ì½”ë“œ + SVG              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.2 í•µì‹¬ ëª¨ë“ˆ ì„¤ê³„

#### ğŸ“¦ Module 1: PromptEngine

```typescript
// src/lib/prompt-engine.ts

export interface DiagramConfig {
  type: 'flowchart' | 'pie' | 'sequence' | 'gantt' | 'er' | 'state' | 'journey' | 'graph';
  systemPrompt: string;
  fewShotExamples?: Array<{ input: string; output: string }>;
  preprocessor?: (input: string) => any;
  validator?: (code: string) => boolean;
}

export class PromptEngine {
  private configs: Map<string, DiagramConfig>;
  
  constructor() {
    this.configs = new Map([
      ['flowchart', FLOWCHART_CONFIG],
      ['pie', PIE_CONFIG],
      // ... ë‚˜ë¨¸ì§€ íƒ€ì…
    ]);
  }
  
  async generatePrompt(
    type: string,
    userInput: string
  ): Promise<{ system: string; user: string }> {
    const config = this.configs.get(type);
    if (!config) throw new Error(`Unknown diagram type: ${type}`);
    
    // ì „ì²˜ë¦¬
    const processed = config.preprocessor 
      ? config.preprocessor(userInput)
      : userInput;
    
    // Few-Shot ì˜ˆì œ í¬í•¨
    const system = config.fewShotExamples
      ? this.buildFewShotPrompt(config.systemPrompt, config.fewShotExamples)
      : config.systemPrompt;
    
    // User í”„ë¡¬í”„íŠ¸ ìƒì„±
    const user = this.buildUserPrompt(type, processed);
    
    return { system, user };
  }
  
  private buildFewShotPrompt(
    systemPrompt: string,
    examples: Array<{ input: string; output: string }>
  ): string {
    const exampleText = examples.map((ex, i) => `
ì˜ˆì œ ${i + 1}:
ì…ë ¥: "${ex.input}"
ì¶œë ¥:
${ex.output}
`).join('\n');
    
    return `${systemPrompt}\n\n**í•™ìŠµ ì˜ˆì œ**:\n${exampleText}`;
  }
  
  private buildUserPrompt(type: string, data: any): string {
    // íƒ€ì…ë³„ User í”„ë¡¬í”„íŠ¸ í…œí”Œë¦¿
    switch (type) {
      case 'flowchart':
        return `ë‹¤ìŒ í”„ë¡œì„¸ìŠ¤ë¥¼ flowchartë¡œ ìƒì„±í•˜ì„¸ìš”:\n"${data}"\n\nì½”ë“œë§Œ ì¶œë ¥í•˜ì„¸ìš”.`;
      case 'pie':
        return `ë‹¤ìŒ ë°ì´í„°ë¥¼ pie ì°¨íŠ¸ë¡œ:\nì œëª©: "${data.title}"\në°ì´í„°: ${JSON.stringify(data.data)}\n\nì½”ë“œë§Œ ì¶œë ¥í•˜ì„¸ìš”.`;
      default:
        return data;
    }
  }
}
```

#### ğŸ“¦ Module 2: APIClient (with Retry)

```typescript
// src/lib/api-client.ts

import { GoogleGenerativeAI } from '@google/generative-ai';
import Anthropic from '@anthropic-ai/sdk';

export interface GenerateOptions {
  maxRetries?: number;
  timeout?: number;
  fallbackToClaude?: boolean;
}

export class DiagramAPIClient {
  private gemini: GoogleGenerativeAI;
  private claude: Anthropic;
  
  constructor(geminiKey: string, claudeKey?: string) {
    this.gemini = new GoogleGenerativeAI(geminiKey);
    if (claudeKey) {
      this.claude = new Anthropic({ apiKey: claudeKey });
    }
  }
  
  async generate(
    systemPrompt: string,
    userPrompt: string,
    options: GenerateOptions = {}
  ): Promise<string> {
    const {
      maxRetries = 3,
      timeout = 30000,
      fallbackToClaude = true
    } = options;
    
    // Primary: Gemini
    for (let i = 0; i < maxRetries; i++) {
      try {
        const result = await this.callGemini(systemPrompt, userPrompt, timeout);
        
        // í›„ì²˜ë¦¬
        const cleaned = this.cleanResponse(result);
        
        // ê¸°ë³¸ ê²€ì¦
        if (this.isValidMermaid(cleaned)) {
          return cleaned;
        }
        
        console.warn(`âš ï¸ Gemini ì‹œë„ ${i + 1}/${maxRetries} ì‹¤íŒ¨: ìœ íš¨í•˜ì§€ ì•Šì€ ì½”ë“œ`);
      } catch (error) {
        console.error(`âŒ Gemini ì‹œë„ ${i + 1}/${maxRetries} ì‹¤íŒ¨:`, error.message);
      }
      
      // ì¬ì‹œë„ ì „ ëŒ€ê¸° (Exponential Backoff)
      if (i < maxRetries - 1) {
        await this.sleep(Math.pow(2, i) * 1000);
      }
    }
    
    // Fallback: Claude
    if (fallbackToClaude && this.claude) {
      console.log('ğŸ”„ Fallback to Claude...');
      try {
        return await this.callClaude(systemPrompt, userPrompt);
      } catch (error) {
        console.error('âŒ Claude fallback ì‹¤íŒ¨:', error.message);
      }
    }
    
    throw new Error('ëª¨ë“  ì‹œë„ ì‹¤íŒ¨: Gemini (3íšŒ) + Claude fallback');
  }
  
  private async callGemini(
    system: string,
    user: string,
    timeout: number
  ): Promise<string> {
    const model = this.gemini.getGenerativeModel({ 
      model: 'gemini-2.0-flash-exp',
      systemInstruction: system
    });
    
    const result = await Promise.race([
      model.generateContent(user),
      this.timeoutPromise(timeout)
    ]);
    
    return result.response.text();
  }
  
  private async callClaude(
    system: string,
    user: string
  ): Promise<string> {
    const response = await this.claude.messages.create({
      model: 'claude-sonnet-4-20250514',
      max_tokens: 2000,
      system,
      messages: [{ role: 'user', content: user }]
    });
    
    return response.content[0].type === 'text' 
      ? response.content[0].text 
      : '';
  }
  
  private cleanResponse(text: string): string {
    return text
      .replace(/```mermaid\n?/g, '')
      .replace(/```\n?/g, '')
      .trim();
  }
  
  private isValidMermaid(code: string): boolean {
    // ê¸°ë³¸ ê²€ì¦: ì‹œì‘ í‚¤ì›Œë“œ í™•ì¸
    const validStarts = [
      'flowchart', 'graph', 'sequenceDiagram', 
      'gantt', 'erDiagram', 'stateDiagram', 
      'journey', 'pie'
    ];
    
    return validStarts.some(keyword => 
      code.toLowerCase().startsWith(keyword.toLowerCase())
    );
  }
  
  private timeoutPromise(ms: number): Promise<never> {
    return new Promise((_, reject) => 
      setTimeout(() => reject(new Error('Timeout')), ms)
    );
  }
  
  private sleep(ms: number): Promise<void> {
    return new Promise(resolve => setTimeout(resolve, ms));
  }
}
```

#### ğŸ“¦ Module 3: MermaidValidator

```typescript
// src/lib/mermaid-validator.ts

import mermaid from 'mermaid';

export interface ValidationResult {
  valid: boolean;
  error?: string;
  svg?: string;
}

export class MermaidValidator {
  async validate(code: string): Promise<ValidationResult> {
    try {
      // Mermaid ì´ˆê¸°í™”
      mermaid.initialize({ 
        startOnLoad: false,
        theme: 'default',
        logLevel: 'error'
      });
      
      // ë Œë”ë§ ì‹œë„
      const { svg } = await mermaid.render(
        `diagram-${Date.now()}`,
        code
      );
      
      return {
        valid: true,
        svg
      };
    } catch (error: any) {
      return {
        valid: false,
        error: error.message
      };
    }
  }
  
  async validateAndRetry(
    code: string,
    onError: (error: string) => Promise<string>,
    maxRetries: number = 3
  ): Promise<ValidationResult> {
    for (let i = 0; i < maxRetries; i++) {
      const result = await this.validate(code);
      
      if (result.valid) {
        return result;
      }
      
      console.warn(`âš ï¸ ê²€ì¦ ì‹¤íŒ¨ (${i + 1}/${maxRetries}):`, result.error);
      
      if (i < maxRetries - 1) {
        // ì—ëŸ¬ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ì¬ìƒì„± ìš”ì²­
        code = await onError(result.error!);
      }
    }
    
    return {
      valid: false,
      error: `${maxRetries}íšŒ ì¬ì‹œë„ í›„ ì‹¤íŒ¨`
    };
  }
}
```

### 3.3 í†µí•© ì›Œí¬í”Œë¡œìš°

```typescript
// src/lib/diagram-generator.ts

export class DiagramGenerator {
  private promptEngine: PromptEngine;
  private apiClient: DiagramAPIClient;
  private validator: MermaidValidator;
  
  constructor(geminiKey: string, claudeKey?: string) {
    this.promptEngine = new PromptEngine();
    this.apiClient = new DiagramAPIClient(geminiKey, claudeKey);
    this.validator = new MermaidValidator();
  }
  
  async generate(
    type: string,
    userInput: string
  ): Promise<{ code: string; svg: string }> {
    // Step 1: í”„ë¡¬í”„íŠ¸ ìƒì„±
    const { system, user } = await this.promptEngine.generatePrompt(type, userInput);
    
    // Step 2: API í˜¸ì¶œ (with Retry)
    const code = await this.apiClient.generate(system, user, {
      maxRetries: 3,
      fallbackToClaude: true
    });
    
    // Step 3: ê²€ì¦ (with Retry)
    const result = await this.validator.validateAndRetry(
      code,
      async (error) => {
        // ì—ëŸ¬ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ì¬ìƒì„±
        const retryPrompt = `${user}\n\nì´ì „ ì‹œë„ì—ì„œ ë‹¤ìŒ ì—ëŸ¬ ë°œìƒ:\n"${error}"\n\nì˜¬ë°”ë¥¸ ì½”ë“œë¥¼ ìƒì„±í•˜ì„¸ìš”.`;
        return await this.apiClient.generate(system, retryPrompt, {
          maxRetries: 1
        });
      },
      3
    );
    
    if (!result.valid) {
      throw new Error(`ë‹¤ì´ì–´ê·¸ë¨ ìƒì„± ì‹¤íŒ¨: ${result.error}`);
    }
    
    return {
      code,
      svg: result.svg!
    };
  }
}
```

---

## ğŸ§ª Part 4: í…ŒìŠ¤íŠ¸ ê³„íš

### 4.1 ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ (Unit Tests)

```typescript
// tests/prompt-engine.test.ts

import { describe, test, expect } from 'bun:test';
import { PromptEngine } from '../src/lib/prompt-engine';

describe('PromptEngine', () => {
  const engine = new PromptEngine();
  
  test('í”Œë¡œìš°ì°¨íŠ¸ í”„ë¡¬í”„íŠ¸ ìƒì„±', async () => {
    const { system, user } = await engine.generatePrompt(
      'flowchart',
      'ë¡œê·¸ì¸ í”„ë¡œì„¸ìŠ¤'
    );
    
    expect(system).toContain('flowchart TD');
    expect(system).toContain('ì˜ˆì œ');
    expect(user).toContain('ë¡œê·¸ì¸ í”„ë¡œì„¸ìŠ¤');
  });
  
  test('íŒŒì´ì°¨íŠ¸ ë°ì´í„° ì „ì²˜ë¦¬', async () => {
    const { user } = await engine.generatePrompt(
      'pie',
      '1ì›”(25%), 2ì›”(30%), 3ì›”(45%)'
    );
    
    expect(user).toContain('"1ì›”" : 25');
    expect(user).not.toContain('%');
  });
});
```

### 4.2 í†µí•© í…ŒìŠ¤íŠ¸ (Integration Tests)

```typescript
// tests/diagram-generator.test.ts

import { describe, test, expect } from 'bun:test';
import { DiagramGenerator } from '../src/lib/diagram-generator';

describe('DiagramGenerator (í”Œë¡œìš°ì°¨íŠ¸)', () => {
  const generator = new DiagramGenerator(
    process.env.GEMINI_API_KEY!,
    process.env.ANTHROPIC_API_KEY
  );
  
  test('ë¡œê·¸ì¸ í”Œë¡œìš°ì°¨íŠ¸ ìƒì„±', async () => {
    const result = await generator.generate(
      'flowchart',
      'ë¡œê·¸ì¸ í”„ë¡œì„¸ìŠ¤: ì‹œì‘ â†’ ì´ë©”ì¼ â†’ ë¹„ë°€ë²ˆí˜¸ â†’ ì¸ì¦ â†’ ì„±ê³µ/ì‹¤íŒ¨'
    );
    
    expect(result.code).toContain('flowchart TD');
    expect(result.code).toContain('ì‹œì‘');
    expect(result.svg).toContain('<svg');
  }, { timeout: 30000 });
  
  test('ë³µì¡í•œ í”Œë¡œìš°ì°¨íŠ¸ ìƒì„±', async () => {
    const result = await generator.generate(
      'flowchart',
      'íšŒì›ê°€ì…: ì´ë©”ì¼ì…ë ¥ â†’ ì¤‘ë³µí™•ì¸ â†’ ë¹„ë°€ë²ˆí˜¸ì…ë ¥ â†’ ì•½ê´€ë™ì˜ â†’ ì¸ì¦ë©”ì¼ â†’ ì™„ë£Œ'
    );
    
    expect(result.code).toMatch(/\{.*\}/); // ì¡°ê±´ ë¶„ê¸° í¬í•¨
    expect(result.svg).toContain('<svg');
  }, { timeout: 30000 });
});

describe('DiagramGenerator (íŒŒì´ì°¨íŠ¸)', () => {
  const generator = new DiagramGenerator(
    process.env.GEMINI_API_KEY!,
    process.env.ANTHROPIC_API_KEY
  );
  
  test('íŒŒì´ì°¨íŠ¸ ìƒì„±', async () => {
    const result = await generator.generate(
      'pie',
      'ì›”ë³„ ë§¤ì¶œ: 1ì›”(25%), 2ì›”(30%), 3ì›”(45%)'
    );
    
    expect(result.code).toContain('pie');
    expect(result.code).toContain('"1ì›”" : 25');
    expect(result.code).not.toContain('%');
    expect(result.svg).toContain('<svg');
  }, { timeout: 30000 });
  
  test('í•©ê³„ê°€ 100ì´ ì•„ë‹Œ íŒŒì´ì°¨íŠ¸', async () => {
    const result = await generator.generate(
      'pie',
      'A(30), B(40), C(50)' // í•©ê³„ 120
    );
    
    // MermaidëŠ” ìë™ìœ¼ë¡œ ë¹„ìœ¨ ê³„ì‚°í•˜ë¯€ë¡œ ì„±ê³µí•´ì•¼ í•¨
    expect(result.code).toContain('pie');
    expect(result.svg).toContain('<svg');
  }, { timeout: 30000 });
});
```

### 4.3 A/B í…ŒìŠ¤íŠ¸ (ì‹¤ì „ ê²€ì¦)

```typescript
// tests/ab-test.ts

import { DiagramGenerator } from '../src/lib/diagram-generator';

async function runABTest() {
  const generator = new DiagramGenerator(
    process.env.GEMINI_API_KEY!,
    process.env.ANTHROPIC_API_KEY
  );
  
  const testCases = [
    { type: 'flowchart', input: 'ë¡œê·¸ì¸ í”„ë¡œì„¸ìŠ¤' },
    { type: 'flowchart', input: 'íšŒì›ê°€ì… í”„ë¡œì„¸ìŠ¤' },
    { type: 'flowchart', input: 'ê²°ì œ í”„ë¡œì„¸ìŠ¤' },
    { type: 'flowchart', input: 'ì£¼ë¬¸ ì·¨ì†Œ í”„ë¡œì„¸ìŠ¤' },
    { type: 'flowchart', input: 'API ìš”ì²­ ì²˜ë¦¬' },
    { type: 'pie', input: '1ì›”(25%), 2ì›”(30%), 3ì›”(45%)' },
    { type: 'pie', input: 'A(10), B(20), C(30), D(40)' },
    { type: 'pie', input: 'ì„œìš¸(50%), ë¶€ì‚°(30%), ëŒ€êµ¬(20%)' },
  ];
  
  let passed = 0;
  const results: Array<{
    type: string;
    input: string;
    success: boolean;
    duration: number;
    error?: string;
  }> = [];
  
  for (const test of testCases) {
    const startTime = Date.now();
    
    try {
      await generator.generate(test.type, test.input);
      passed++;
      results.push({
        ...test,
        success: true,
        duration: Date.now() - startTime
      });
      console.log(`âœ… ${test.type}: ${test.input.substring(0, 30)}...`);
    } catch (error: any) {
      results.push({
        ...test,
        success: false,
        duration: Date.now() - startTime,
        error: error.message
      });
      console.error(`âŒ ${test.type}: ${test.input.substring(0, 30)}...`);
    }
  }
  
  const successRate = (passed / testCases.length * 100).toFixed(1);
  const avgDuration = results
    .filter(r => r.success)
    .reduce((sum, r) => sum + r.duration, 0) / (passed || 1);
  
  console.log('\nğŸ“Š A/B í…ŒìŠ¤íŠ¸ ê²°ê³¼:');
  console.log(`   ì„±ê³µë¥ : ${successRate}% (${passed}/${testCases.length})`);
  console.log(`   í‰ê·  ì†Œìš” ì‹œê°„: ${avgDuration.toFixed(0)}ms`);
  console.log(`   ëª©í‘œ ë‹¬ì„±: ${successRate >= '95' ? 'âœ…' : 'âŒ'}`);
  
  return results;
}

// ì‹¤í–‰
runABTest();
```

---

## ğŸ“¦ Part 5: ë°°í¬ íŒ¨í‚¤ì§€

### 5.1 í”„ë¡œì íŠ¸ êµ¬ì¡°

```
snapchart-improved/
â”œâ”€â”€ package.json
â”œâ”€â”€ tsconfig.json
â”œâ”€â”€ .env.example
â”œâ”€â”€ .env
â”œâ”€â”€ bun.lockb
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ lib/
â”‚   â”‚   â”œâ”€â”€ prompt-engine.ts          # í”„ë¡¬í”„íŠ¸ ìƒì„± ì—”ì§„
â”‚   â”‚   â”œâ”€â”€ api-client.ts             # API í´ë¼ì´ì–¸íŠ¸ (Retry í¬í•¨)
â”‚   â”‚   â”œâ”€â”€ mermaid-validator.ts      # Mermaid ê²€ì¦ê¸°
â”‚   â”‚   â”œâ”€â”€ diagram-generator.ts      # í†µí•© ìƒì„±ê¸°
â”‚   â”‚   â””â”€â”€ configs/
â”‚   â”‚       â”œâ”€â”€ flowchart.config.ts   # í”Œë¡œìš°ì°¨íŠ¸ ì„¤ì •
â”‚   â”‚       â”œâ”€â”€ pie.config.ts         # íŒŒì´ì°¨íŠ¸ ì„¤ì •
â”‚   â”‚       â””â”€â”€ index.ts
â”‚   â””â”€â”€ index.ts                      # ì§„ì…ì 
â”œâ”€â”€ tests/
â”‚   â”œâ”€â”€ prompt-engine.test.ts
â”‚   â”œâ”€â”€ diagram-generator.test.ts
â”‚   â””â”€â”€ ab-test.ts
â”œâ”€â”€ results/
â”‚   â”œâ”€â”€ test-report.md
â”‚   â””â”€â”€ diagrams/
â””â”€â”€ README.md
```

### 5.2 package.json

```json
{
  "name": "snapchart-improved",
  "version": "2.0.0",
  "description": "SnapChart í”Œë¡œìš°ì°¨íŠ¸Â·íŒŒì´ì°¨íŠ¸ ìƒì„± ì„±ê³µë¥  ê°œì„ ",
  "type": "module",
  "scripts": {
    "test": "bun test",
    "test:unit": "bun test tests/*.test.ts",
    "test:ab": "bun run tests/ab-test.ts",
    "dev": "bun run src/index.ts",
    "build": "bun build src/index.ts --outdir=dist --target=node",
    "clean": "rm -rf dist results/diagrams/*"
  },
  "dependencies": {
    "@google/generative-ai": "^0.21.0",
    "@anthropic-ai/sdk": "^0.32.1",
    "mermaid": "^11.4.0"
  },
  "devDependencies": {
    "@types/node": "^22.10.0",
    "typescript": "^5.7.2"
  },
  "engines": {
    "bun": ">=1.1.0"
  }
}
```

### 5.3 ì‹¤í–‰ ìŠ¤í¬ë¦½íŠ¸

```bash
#!/bin/bash
# run-improved-test.sh

echo "ğŸš€ SnapChart ê°œì„  í…ŒìŠ¤íŠ¸ ì‹œì‘"
echo ""

# í™˜ê²½ í™•ì¸
if ! command -v bun &> /dev/null; then
    echo "âŒ Bunì´ ì„¤ì¹˜ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤."
    echo "ì„¤ì¹˜: curl -fsSL https://bun.sh/install | bash"
    exit 1
fi

# API í‚¤ í™•ì¸
if [ ! -f ".env" ]; then
    echo "âŒ .env íŒŒì¼ì´ ì—†ìŠµë‹ˆë‹¤."
    echo "GEMINI_API_KEYì™€ ANTHROPIC_API_KEYë¥¼ ì„¤ì •í•˜ì„¸ìš”."
    exit 1
fi

# ì˜ì¡´ì„± ì„¤ì¹˜
echo "ğŸ“¦ ì˜ì¡´ì„± ì„¤ì¹˜ ì¤‘..."
bun install

# ë‹¨ìœ„ í…ŒìŠ¤íŠ¸
echo ""
echo "ğŸ§ª ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ ì‹¤í–‰ ì¤‘..."
bun test:unit

# A/B í…ŒìŠ¤íŠ¸
echo ""
echo "ğŸ“Š A/B í…ŒìŠ¤íŠ¸ ì‹¤í–‰ ì¤‘..."
bun test:ab

echo ""
echo "âœ… í…ŒìŠ¤íŠ¸ ì™„ë£Œ!"
echo "ğŸ“„ ê²°ê³¼: results/test-report.md"
```

---

## ğŸ¯ Part 6: ì„±ê³µ ê¸°ì¤€ & ê²€ì¦

### 6.1 ëª©í‘œ ì§€í‘œ

| ì§€í‘œ | í˜„ì¬ | ëª©í‘œ | ì¸¡ì • ë°©ë²• |
|------|------|------|-----------|
| **í”Œë¡œìš°ì°¨íŠ¸ ì„±ê³µë¥ ** | 0% | 95%+ | 10íšŒ í…ŒìŠ¤íŠ¸ |
| **íŒŒì´ì°¨íŠ¸ ì„±ê³µë¥ ** | 0% | 95%+ | 10íšŒ í…ŒìŠ¤íŠ¸ |
| **ì „ì²´ ì„±ê³µë¥ ** | 75% | 95%+ | 8ê°œ íƒ€ì… Ã— 5íšŒ |
| **í‰ê·  ì‘ë‹µ ì‹œê°„** | 6.2ì´ˆ | 4.5ì´ˆ | Bun ì ìš© |
| **Gemini ì„±ê³µë¥ ** | 70% | 90%+ | Primary API |
| **Claude Fallback ë¹„ìœ¨** | - | <10% | ë³´ì¡° API |

### 6.2 ê²€ì¦ í”„ë¡œì„¸ìŠ¤

#### Phase 1: ê°œë°œ í™˜ê²½ ê²€ì¦ (1ì¼)
```
â–¡ ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ 100% í†µê³¼
â–¡ í”Œë¡œìš°ì°¨íŠ¸ í”„ë¡¬í”„íŠ¸ 10íšŒ í…ŒìŠ¤íŠ¸ â†’ 95%+ ì„±ê³µ
â–¡ íŒŒì´ì°¨íŠ¸ í”„ë¡¬í”„íŠ¸ 10íšŒ í…ŒìŠ¤íŠ¸ â†’ 95%+ ì„±ê³µ
â–¡ ì½”ë“œ ë¦¬ë·° ì™„ë£Œ
```

#### Phase 2: í†µí•© í…ŒìŠ¤íŠ¸ (2ì¼)
```
â–¡ 8ê°œ íƒ€ì… ê° 5íšŒ í…ŒìŠ¤íŠ¸ (ì´ 40íšŒ)
â–¡ ì„±ê³µë¥  95%+ ë‹¬ì„± í™•ì¸
â–¡ í‰ê·  ì‘ë‹µ ì‹œê°„ 5ì´ˆ ì´ë‚´ í™•ì¸
â–¡ ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ ì—†ìŒ í™•ì¸
```

#### Phase 3: ì‹¤ì „ ê²€ì¦ (3ì¼)
```
â–¡ ë² íƒ€ ì‚¬ìš©ì 10ëª… í…ŒìŠ¤íŠ¸
â–¡ 100ê°œ ì‹¤ì œ ì…ë ¥ í…ŒìŠ¤íŠ¸
â–¡ Edge Case í…ŒìŠ¤íŠ¸ (ë¹„ì •ìƒ ì…ë ¥)
â–¡ ë¶€í•˜ í…ŒìŠ¤íŠ¸ (100 req/min)
```

### 6.3 Go/No-Go íŒë‹¨

```
âœ… GO (ì¦‰ì‹œ MVP ê°œë°œ ì§„í–‰)
- í”Œë¡œìš°ì°¨íŠ¸ ì„±ê³µë¥  â‰¥ 95%
- íŒŒì´ì°¨íŠ¸ ì„±ê³µë¥  â‰¥ 95%
- ì „ì²´ ì„±ê³µë¥  â‰¥ 95%
- í‰ê·  ì‘ë‹µ ì‹œê°„ â‰¤ 5ì´ˆ

âš ï¸ CAUTION (ì¶”ê°€ ê°œì„ )
- í”Œë¡œìš°ì°¨íŠ¸ ì„±ê³µë¥  90~95%
- íŒŒì´ì°¨íŠ¸ ì„±ê³µë¥  90~95%
- í”„ë¡¬í”„íŠ¸ ë¯¸ì„¸ ì¡°ì • í•„ìš”

âŒ NO-GO (ì¬ì„¤ê³„)
- í”Œë¡œìš°ì°¨íŠ¸ ì„±ê³µë¥  < 90%
- ëŒ€ì•ˆ API ê²€í†  (GPT-4o)
```

---

## ğŸ“… Part 7: êµ¬í˜„ ì¼ì •

### 7.1 ê°œë°œ íƒ€ì„ë¼ì¸ (5ì¼)

#### Day 1: í”„ë¡¬í”„íŠ¸ ì—”ì§„ ê°œë°œ
```
AM (4h):
- PromptEngine í´ë˜ìŠ¤ êµ¬í˜„
- í”Œë¡œìš°ì°¨íŠ¸ Config ì‘ì„±
- Few-Shot ì˜ˆì œ 3ê°œ ì‘ì„±

PM (4h):
- íŒŒì´ì°¨íŠ¸ Config ì‘ì„±
- ë°ì´í„° ì „ì²˜ë¦¬ ë¡œì§ êµ¬í˜„
- ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ ì‘ì„±
```

#### Day 2: API í´ë¼ì´ì–¸íŠ¸ ê°œë°œ
```
AM (4h):
- APIClient í´ë˜ìŠ¤ êµ¬í˜„
- Retry ë©”ì»¤ë‹ˆì¦˜ êµ¬í˜„
- Timeout ì²˜ë¦¬

PM (4h):
- Claude Fallback êµ¬í˜„
- Exponential Backoff ì ìš©
- ì—ëŸ¬ í•¸ë“¤ë§ ê°•í™”
```

#### Day 3: ê²€ì¦ ì‹œìŠ¤í…œ ê°œë°œ
```
AM (4h):
- MermaidValidator êµ¬í˜„
- ë¬¸ë²• ê²€ì¦ ë¡œì§
- ë Œë”ë§ í…ŒìŠ¤íŠ¸

PM (4h):
- DiagramGenerator í†µí•©
- End-to-End í…ŒìŠ¤íŠ¸
- ì„±ëŠ¥ ìµœì í™”
```

#### Day 4: í…ŒìŠ¤íŠ¸ & ê²€ì¦
```
AM (4h):
- ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ ì‹¤í–‰
- í†µí•© í…ŒìŠ¤íŠ¸ ì‹¤í–‰
- A/B í…ŒìŠ¤íŠ¸ (10íšŒì”©)

PM (4h):
- ë²„ê·¸ ìˆ˜ì •
- Edge Case ì²˜ë¦¬
- ë¬¸ì„œí™”
```

#### Day 5: ìµœì¢… ê²€ì¦ & ë°°í¬ ì¤€ë¹„
```
AM (4h):
- ë² íƒ€ í…ŒìŠ¤í„° ì´ˆëŒ€
- ì‹¤ì „ ë°ì´í„° í…ŒìŠ¤íŠ¸
- ì„±ê³µë¥  ì¸¡ì •

PM (4h):
- ë¦¬í¬íŠ¸ ì‘ì„±
- Go/No-Go íŒë‹¨
- MVP ê°œë°œ ê³„íš ìˆ˜ë¦½
```

### 7.2 Task ì²´í¬ë¦¬ìŠ¤íŠ¸

```markdown
## ê°œë°œ Task (19ê°œ)

### Core Engine (7ê°œ)
- [ ] PromptEngine í´ë˜ìŠ¤ êµ¬í˜„
- [ ] í”Œë¡œìš°ì°¨íŠ¸ Config (Few-Shot í¬í•¨)
- [ ] íŒŒì´ì°¨íŠ¸ Config (ë°ì´í„° ì „ì²˜ë¦¬ í¬í•¨)
- [ ] APIClient í´ë˜ìŠ¤ êµ¬í˜„
- [ ] Retry & Timeout ë©”ì»¤ë‹ˆì¦˜
- [ ] Claude Fallback ë¡œì§
- [ ] MermaidValidator êµ¬í˜„

### Testing (6ê°œ)
- [ ] PromptEngine ë‹¨ìœ„ í…ŒìŠ¤íŠ¸
- [ ] APIClient ë‹¨ìœ„ í…ŒìŠ¤íŠ¸
- [ ] MermaidValidator ë‹¨ìœ„ í…ŒìŠ¤íŠ¸
- [ ] DiagramGenerator í†µí•© í…ŒìŠ¤íŠ¸
- [ ] A/B í…ŒìŠ¤íŠ¸ ìŠ¤í¬ë¦½íŠ¸
- [ ] ì„±ëŠ¥ ë²¤ì¹˜ë§ˆí¬

### Documentation (3ê°œ)
- [ ] API ë¬¸ì„œ ì‘ì„±
- [ ] ì‚¬ìš© ê°€ì´ë“œ ì‘ì„±
- [ ] í…ŒìŠ¤íŠ¸ ë¦¬í¬íŠ¸ ìƒì„±

### Deployment (3ê°œ)
- [ ] package.json ì„¤ì •
- [ ] ì‹¤í–‰ ìŠ¤í¬ë¦½íŠ¸ ì‘ì„±
- [ ] CI/CD íŒŒì´í”„ë¼ì¸ ì„¤ì •
```

---

## ğŸ’¡ Part 8: ì˜ˆìƒ ê²°ê³¼

### 8.1 ì„±ê³µ ì‹œë‚˜ë¦¬ì˜¤

```
ğŸ“Š ìµœì¢… í…ŒìŠ¤íŠ¸ ê²°ê³¼ (ì˜ˆìƒ)
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
í”Œë¡œìš°ì°¨íŠ¸:  âœ… 96% (48/50)
íŒŒì´ì°¨íŠ¸:    âœ… 98% (49/50)
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ì „ì²´ ì„±ê³µë¥ : âœ… 97.5% (390/400)

âš¡ ì„±ëŠ¥ ì§€í‘œ
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
í‰ê·  ì‘ë‹µ ì‹œê°„: 4.2ì´ˆ (Bun ì ìš©)
Gemini ì„±ê³µë¥ : 92%
Claude Fallback: 5% (20/400)
ìºì‹œ ì ì¤‘ë¥ : 0% (ì´ˆê¸°)

ğŸ’° ë¹„ìš© ë¶„ì„
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
Gemini ë¹„ìš©: $0.0020/ìš”ì²­ (92%)
Claude ë¹„ìš©: $0.0165/ìš”ì²­ (5%)
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
í‰ê·  ë¹„ìš©: $0.0026/ìš”ì²­
(ê¸°ì¡´ ëª©í‘œ $0.0020 ëŒ€ë¹„ +30%, ì—¬ì „íˆ ê²½ìŸë ¥ ìˆìŒ)

ğŸ¯ ìµœì¢… íŒì •
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
âœ… GO - ì¦‰ì‹œ MVP ê°œë°œ ì§„í–‰!
```

### 8.2 ì‹¤íŒ¨ ì‹œ ëŒ€ì•ˆ

```
ë§Œì•½ ëª©í‘œ ë¯¸ë‹¬ ì‹œ (< 90%):

Plan B: í”„ë¡¬í”„íŠ¸ ì¶”ê°€ ê°œì„ 
- Few-Shot ì˜ˆì œ 3ê°œ â†’ 5ê°œë¡œ ì¦ê°€
- Chain-of-Thought í”„ë¡¬í”„íŠ¸ ì ìš©
- ë” ëª…ì‹œì ì¸ ì¶œë ¥ ì œì•½ ì¡°ê±´

Plan C: Hybrid ì „ëµ
- í”Œë¡œìš°ì°¨íŠ¸: Claude ì „ìš©
- ë‚˜ë¨¸ì§€ 7ê°œ: Gemini
- ë¹„ìš©ì€ ì¦ê°€í•˜ì§€ë§Œ í’ˆì§ˆ ë³´ì¥

Plan D: API ë³€ê²½
- Gemini â†’ GPT-4o mini í…ŒìŠ¤íŠ¸
- ë¹„ìš© ë¹„êµ ($0.0015 vs $0.0020)
- ì„±ê³µë¥  ì¬ì¸¡ì •
```

---

## ğŸ“ Part 9: ìµœì¢… ìš”ì•½

### í•µì‹¬ ì „ëµ

1. **í”„ë¡¬í”„íŠ¸ ì—”ì§€ë‹ˆì–´ë§** (ê°€ì¥ ì¤‘ìš”)
   - Few-Shot í•™ìŠµ ì ìš©
   - ëª…ì‹œì  ì¶œë ¥ í¬ë§· ì§€ì •
   - íƒ€ì…ë³„ ë§ì¶¤ í…œí”Œë¦¿

2. **ì¬ì‹œë„ ë©”ì»¤ë‹ˆì¦˜**
   - ìµœëŒ€ 3íšŒ ìë™ ì¬ì‹œë„
   - Exponential Backoff
   - Claude Fallback (5% ì˜ˆìƒ)

3. **ê²€ì¦ ì‹œìŠ¤í…œ**
   - Mermaid ë¬¸ë²• ì‚¬ì „ ê²€ì¦
   - ë Œë”ë§ í…ŒìŠ¤íŠ¸ í†µê³¼ ì‹œ í™•ì •
   - ì‹¤íŒ¨ ì‹œ ì—ëŸ¬ í”¼ë“œë°± ê¸°ë°˜ ì¬ìƒì„±

4. **ì„±ëŠ¥ ìµœì í™”**
   - Node.js â†’ Bun (4ë°° ë¹ ë¦„)
   - í‰ê·  6.2ì´ˆ â†’ 4.2ì´ˆ ì˜ˆìƒ

### ì˜ˆìƒ ì„±ê³¼

| ì§€í‘œ | ê°œì„  ì „ | ê°œì„  í›„ | ê°œì„ ìœ¨ |
|------|---------|---------|--------|
| í”Œë¡œìš°ì°¨íŠ¸ ì„±ê³µë¥  | 0% | 96% | +96%p |
| íŒŒì´ì°¨íŠ¸ ì„±ê³µë¥  | 0% | 98% | +98%p |
| ì „ì²´ ì„±ê³µë¥  | 75% | 97.5% | +22.5%p |
| í‰ê·  ì‘ë‹µ ì‹œê°„ | 6.2ì´ˆ | 4.2ì´ˆ | -32% |
| ë¹„ìš© | $0.0020 | $0.0026 | +30% |

### ë‹¤ìŒ ë‹¨ê³„

```
âœ… Day 1-5: ê°œì„  êµ¬í˜„ ë° í…ŒìŠ¤íŠ¸
âœ… Day 6: Go/No-Go íŒë‹¨
âœ… Day 7: MVP ê°œë°œ ì°©ìˆ˜

ì˜ˆìƒ MVP ì¶œì‹œ: 7ì£¼ í›„
```

---

**ëª…ì„¸ì„œ ì‘ì„± ì™„ë£Œ**  
**ì‘ì„±ì**: ì•„í…Œë‚˜ (AI ì—”ì§€ë‹ˆì–´) + ë±ìŠ¤ (í’€ìŠ¤íƒ)  
**ìŠ¹ì¸ ëŒ€ê¸°**: CEO  
**ë‹¤ìŒ ì—…ë°ì´íŠ¸**: 5ì¼ í›„ (í…ŒìŠ¤íŠ¸ ê²°ê³¼ ë¦¬í¬íŠ¸)